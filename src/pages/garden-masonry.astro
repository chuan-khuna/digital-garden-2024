---
import type { CollectionEntry } from 'astro:content'
import BaseLayout from '@/layouts/BaseLayout.astro'
import { getCollection } from 'astro:content'
import PostCard from '@/components/post/PostCard.astro'

// Get all posts and notes
let allPosts = await getCollection('posts')
let allNotes = await getCollection('notes')

// Add collection type to each article
allPosts = allPosts.map((post) => ({
  ...post,
  collection: 'posts',
}))
allNotes = allNotes.map((note) => ({
  ...note,
  collection: 'notes',
}))

const allArticles = [...allPosts, ...allNotes]

// Sort articles by date (newest first)
const allArticleSortedByDate = allArticles.sort((a, b) => {
  const dateA = a.data.date ? new Date(a.data.date).getTime() : 0
  const updatedA = a.data.updated ? new Date(a.data.updated).getTime() : 0
  const maxA = Math.max(dateA, updatedA)

  const dateB = b.data.date ? new Date(b.data.date).getTime() : 0
  const updatedB = b.data.updated ? new Date(b.data.updated).getTime() : 0
  const maxB = Math.max(dateB, updatedB)

  return maxB - maxA
})

const meta = {
  title: 'Garden',
  description: 'A collection of my digital garden notes and thoughts',
}
---

<BaseLayout title={meta.title} description={meta.description}>
  <div class="container mx-auto px-4 py-8">
    <!-- Masonry Grid for All Articles -->
    <section>
      <!-- CSS Columns Masonry Layout -->
      <div class="columns-1 gap-6 sm:columns-2 lg:columns-3">
        {
          allArticleSortedByDate.map((article) => (
            <div class="mb-6 break-inside-avoid">
              <PostCard article={article} rootURL={article.collection} />
            </div>
          ))
        }
      </div>
    </section>
  </div>
</BaseLayout>

<style>
  /* Ensure masonry items don't break across columns */
  .break-inside-avoid {
    break-inside: avoid;
    page-break-inside: avoid;
  }
</style>
