---
import '@/styles/global.css'

import BaseLayout from './BaseLayout.astro'
import { BackReferenceSection } from '@/components/post/back-reference.tsx'

const { frontmatter, incomingNotes, outgoingNotes, rootURL, ogImage } =
  Astro.props
// console.log("incomingNotes:", incomingNotes);
// console.log("outgoingNotes:", outgoingNotes);

// incomingNotes: an array of note objects from Astro getCollection()
// outgoingNotes: an array of note objects from Astro getCollection()
// to access frontmatter of a note, use note.data
---

<BaseLayout title={frontmatter.title} ogImage={ogImage}>
  <!-- content container -->
  <div id="prose-container" class="overflow-x-hidden">
    <div
      id="prose-content-wrapper"
      class="prose-cactus prose mx-auto mt-12 w-full max-w-[80ch] prose-headings:font-semibold prose-headings:text-cactus-accent-2 prose-headings:before:absolute prose-headings:before:-ms-4 prose-headings:before:text-cactus-accent prose-headings:before:content-['#'] prose-a:break-words prose-code:break-words prose-th:before:content-none"
    >
      <slot />
    </div>
    <BackReferenceSection
      incomingReferences={incomingNotes}
      outgoingReferences={outgoingNotes}
      rootURL={rootURL}
    />
  </div>
</BaseLayout>

<style is:global>
  /* Table responsive wrapper */
  #prose-content-wrapper table {
    display: block;
    max-width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* Ensure table cells don't break awkwardly */
  #prose-content-wrapper td,
  #prose-content-wrapper th {
    vertical-align: top;
    word-wrap: break-word;
    max-width: 300px;
  }

  /* Handle long URLs in links */
  #prose-content-wrapper a {
    word-break: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
  }

  /* Better handling for code blocks with long content */
  #prose-content-wrapper code {
    word-break: break-word;
    white-space: pre-wrap;
  }

  /* Prevent pre blocks from causing overflow */
  #prose-content-wrapper pre {
    max-width: 100%;
    overflow-x: auto;
  }

  /* Handle highlight marks (==text==) if using remark-mark or similar */
  #prose-content-wrapper mark {
    background-color: hsl(var(--theme-accent) / 0.3);
    padding: 0.1em 0.2em;
    border-radius: 2px;
  }
</style>
