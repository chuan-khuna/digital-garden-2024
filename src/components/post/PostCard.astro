---
import type { CollectionEntry } from 'astro:content'

interface Props {
  article: CollectionEntry<'posts'> | CollectionEntry<'notes'>
  rootURL?: string
}

const { article, rootURL = 'posts' } = Astro.props

// Format date
const formatDate = (dateString: string | undefined) => {
  if (!dateString) return null
  const date = new Date(dateString)
  return date.toLocaleDateString('en-UK', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  })
}

// Use updated date if available, otherwise fall back to date
const dateToDisplay = article.data.updated || article.data.date
const formattedDate = formatDate(dateToDisplay)
const isUpdated = !!article.data.updated

// Get stage icon and color
const stageConfig = {
  seedling: { icon: 'ðŸŒ±', label: 'Seedling' },
  budding: { icon: 'ðŸŒ¿', label: 'Budding' },
  evergreen: { icon: 'ðŸŒ²', label: 'Evergreen' },
}

const stage = article.data.stage ? stageConfig[article.data.stage] : null

// Determine card type label (hidden in UI)
const cardType =
  rootURL === 'notes' ? 'Note' : rootURL === 'posts' ? 'Pattern' : 'Essay'

// Truncate description to 200 characters
const truncateText = (text: string | undefined, maxLength: number) => {
  if (!text) return ''
  if (text.length <= maxLength) return text
  return text.slice(0, maxLength).trim() + '...'
}

const truncatedDescription = truncateText(article.data.description, 200)
---

<article
  class="group relative flex flex-col gap-3 rounded-lg border border-border bg-card p-6 shadow-sm transition-all duration-200 hover:border-accent hover:shadow-md"
>
  <!-- Title -->
  <a
    href={`/${rootURL}/${article.id}`}
    class="text-lg font-semibold text-card-foreground transition-colors group-hover:text-accent"
  >
    <span class="group-hover:underline">{article.data.title}</span>
  </a>

  <!-- Description -->
  {
    truncatedDescription && (
      <p class="text-card-foreground/70 line-clamp-3 text-sm">
        {truncatedDescription}
      </p>
    )
  }
  <!-- Header with icon and date -->
  <div class="flex items-center justify-between">
    {
      formattedDate && (
        <time class="text-card-foreground/70 text-xs">{formattedDate}</time>
      )
    }
  </div>
</article>
